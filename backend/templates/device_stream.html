<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Device Stream — ShipTrack</title>
    <link rel="stylesheet" href="/static/styles.css">
</head>
<body class="dashboard device-stream-page">
    <div class="page-container">
        <header class="page-header">
            <a href="/devices" class="btn-outline">← Back to Devices</a>
            <h1>Device: {{ device_id }}</h1>
        </header>

        <main class="page-main">
            <section class="device-info">
                {% if device %}
                <h2>Last known details</h2>
                <ul>
                    {% for k, v in device.items() %}
                    <li><strong>{{ k }}:</strong> {{ v }}</li>
                    {% endfor %}
                </ul>
                {% else %}
                <div class="alert alert-info">No data found for this device yet.</div>
                {% endif %}
            </section>

            <section class="live-stream">
                <h2>Live stream</h2>
                <div id="streamArea" class="stream-area">Waiting for updates...</div>
            </section>
        </main>
    </div>

    <script>
        // Simple polling to simulate live stream
        const deviceId = "{{ device_id }}";
        async function poll() {
            try {
                const res = await fetch(`/api/devices`);
                if (!res.ok) return;
                const data = await res.json();
                const matches = data.devices.filter(d => d.Device === deviceId);
                const area = document.getElementById('streamArea');
                if (!matches.length) {
                    area.textContent = 'No recent updates for this device.';
                    return;
                }
                // show the latest record
                const latest = matches[matches.length - 1];
                area.textContent = JSON.stringify(latest, null, 2);
            } catch (err) {
                console.error('Polling error', err);
            }
        }
        setInterval(poll, 3000);
        poll();
    </script>
</body>
</html>
